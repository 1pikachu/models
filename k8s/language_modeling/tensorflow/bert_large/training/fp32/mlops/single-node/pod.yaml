apiVersion: v1
kind: Pod
metadata:
  name: bert-large-fp32-training # {"$openapi":"MODEL_NAME"}
spec:
  serviceAccountName: bert-large-fp32-training # {"$openapi":"MODEL_NAME"}
  securityContext:
    runAsUser: 0 # {"$openapi":"USER_ID"}
    runAsGroup: 0 # {"$openapi":"GROUP_ID"}
    fsGroup: 0 # {"$openapi":"FS_ID"}
  containers:
  - name: single-node
    image: docker.io/intel/language-modeling:tf-2.3.0-imz-2.0.0-bert-large-fp32-training # {"$openapi":"IMAGE"}
    workingDir: /workspace/bert-large-fp32-training # {"$openapi":"MODEL_DIR"}
    command: # {"$openapi":"COMMAND"}
    - /workspace/bert-large-fp32-training/quickstart/fp32_training_single_node.sh # {"$openapi":"COMMAND"}
    env:
    - name: BERT_BASE_DIR
      value: bert_official/MRPC # {"$openapi":"BERT_BASE_DIR"}
    - name: DATASET_DIR
      value: /datasets # {"$openapi":"DATASET_DIR"}
    - name: GLUE_DIR
      value: bert_official # {"$openapi":"GLUE_DIR"}
    - name: GROUP_ID
      value: "0" # {"$openapi":"GROUP_ID_VALUE"}
    - name: GROUP_NAME
      value: root # {"$openapi":"GROUP_NAME"}
    - name: OUTPUT_DIR
      value: /nfs/root/bert-large-fp32-training/output # {"$openapi":"OUTPUT_PATH"}
    - name: USER_ID
      value: "0" # {"$openapi":"USER_ID_VALUE"}
    - name: USER_NAME
      value: root # {"$openapi":"USER_NAME"}
    volumeMounts:
    - name: datasets
      mountPath: /datasets # {"$openapi":"DATASET_DIR"}
      readOnly: true
    - name: nfs-path
      mountPath: /nfs # {"$openapi":"NFS_PATH"}
    - name: mlops-scripts
      mountPath: /workspace/bert-large-fp32-training/quickstart/fp32_training_single_node.sh # {"$openapi":"COMMAND"}
      subPath: fp32_training_single_node.sh # {"$openapi":"MODEL_SCRIPT"}
  volumes:
  - name: datasets
    hostPath:
      path: /datasets # {"$openapi":"DATASET_DIR"}
  - name: nfs-path
    nfs:
      server: 0.0.0.0 # {"$openapi":"NFS_SERVER"}
      path: /nfs # {"$openapi":"NFS_PATH"}
  - name: mlops-scripts
    configMap:
      name: mlops-scripts
      defaultMode: 0770
      items:
      - key: fp32_training_single_node.sh # {"$openapi":"MODEL_SCRIPT"}
        path: fp32_training_single_node.sh # {"$openapi":"MODEL_SCRIPT"}
  restartPolicy: OnFailure
