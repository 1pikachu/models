apiVersion: kubeflow.org/v1alpha2
kind: MPIJob
metadata:
  name: $(MODEL_NAME)
spec:
  slotsPerWorker: 1
  cleanPodPolicy: Running
  mpiReplicaSpecs:
    Launcher:
      replicas: 1
      template:
        spec:
          serviceAccountName: model-service
          containers:
          - name: mpi-launcher
            imagePullPolicy: Always
            workingDir: /
          volumes:
          - name: datasets
            persistentVolumeClaim:
              claimName: datasets-pvc
          - name: users
            persistentVolumeClaim:
              claimName: users-pvc
    Worker:
      replicas: 2
      template:
        spec:
          serviceAccountName: model-service
          containers:
          - name: mpi-worker
            imagePullPolicy: Always
            workingDir: /
          volumes:
          - name: datasets
            persistentVolumeClaim:
              claimName: datasets-pvc
          - name: users
            persistentVolumeClaim:
              claimName: users-pvc
